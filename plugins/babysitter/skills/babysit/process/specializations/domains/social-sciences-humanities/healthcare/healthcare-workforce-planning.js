/**
 * @process specializations/domains/social-sciences-humanities/healthcare/healthcare-workforce-planning
 * @description Healthcare Workforce Planning - Comprehensive methodology for forecasting, developing,
 * and managing healthcare workforce capacity aligned with patient care demands and strategic objectives.
 * @inputs { organizationName: string, planningScope?: string, departments?: array, planningHorizon?: number }
 * @outputs { success: boolean, workforcePlan: object, staffingModels: array, developmentPlan: object, artifacts: array }
 */

import { defineTask } from '@a5c-ai/babysitter-sdk';

export async function process(inputs, ctx) {
  const { organizationName, planningScope = 'enterprise', departments = [], planningHorizon = 3, outputDir = 'workforce-planning-output' } = inputs;
  const startTime = ctx.now();
  const artifacts = [];

  ctx.log('info', `Starting Healthcare Workforce Planning for: ${organizationName}`);

  const currentStateAnalysis = await ctx.task(wfCurrentStateTask, { organizationName, planningScope, departments, outputDir });
  artifacts.push(...currentStateAnalysis.artifacts);

  await ctx.breakpoint({ question: `Current state analyzed. Total FTEs: ${currentStateAnalysis.totalFTEs}. Turnover rate: ${currentStateAnalysis.turnoverRate}%. ${currentStateAnalysis.criticalVacancies} critical vacancies. Proceed?`, title: 'Workforce Current State Review', context: { runId: ctx.runId, ftes: currentStateAnalysis.totalFTEs, turnover: currentStateAnalysis.turnoverRate } });

  const demandForecasting = await ctx.task(wfDemandForecastTask, { currentStateAnalysis, planningHorizon, outputDir });
  artifacts.push(...demandForecasting.artifacts);

  const supplyAnalysis = await ctx.task(wfSupplyAnalysisTask, { currentStateAnalysis, demandForecasting, outputDir });
  artifacts.push(...supplyAnalysis.artifacts);

  const gapAnalysis = await ctx.task(wfGapAnalysisTask, { demandForecasting, supplyAnalysis, outputDir });
  artifacts.push(...gapAnalysis.artifacts);

  await ctx.breakpoint({ question: `Gap analysis complete. ${gapAnalysis.shortfalls.length} skill shortfalls identified. ${gapAnalysis.surplusAreas.length} surplus areas. Proceed with staffing models?`, title: 'Workforce Gap Review', context: { runId: ctx.runId, shortfalls: gapAnalysis.shortfalls, surplus: gapAnalysis.surplusAreas } });

  const staffingModels = await ctx.task(wfStaffingModelsTask, { demandForecasting, gapAnalysis, outputDir });
  artifacts.push(...staffingModels.artifacts);

  const recruitmentStrategy = await ctx.task(wfRecruitmentTask, { gapAnalysis, outputDir });
  artifacts.push(...recruitmentStrategy.artifacts);

  const retentionStrategy = await ctx.task(wfRetentionTask, { currentStateAnalysis, outputDir });
  artifacts.push(...retentionStrategy.artifacts);

  const developmentPlan = await ctx.task(wfDevelopmentTask, { gapAnalysis, staffingModels, outputDir });
  artifacts.push(...developmentPlan.artifacts);

  const successionPlanning = await ctx.task(wfSuccessionTask, { currentStateAnalysis, outputDir });
  artifacts.push(...successionPlanning.artifacts);

  const implementationPlan = await ctx.task(wfImplementationTask, { staffingModels, recruitmentStrategy, retentionStrategy, developmentPlan, outputDir });
  artifacts.push(...implementationPlan.artifacts);

  const documentation = await ctx.task(wfDocumentationTask, { organizationName, currentStateAnalysis, demandForecasting, supplyAnalysis, gapAnalysis, staffingModels, recruitmentStrategy, retentionStrategy, developmentPlan, successionPlanning, implementationPlan, outputDir });
  artifacts.push(...documentation.artifacts);

  return { success: true, organizationName, workforcePlan: { currentState: currentStateAnalysis.summary, demandForecast: demandForecasting.forecast, gaps: gapAnalysis.summary }, staffingModels: staffingModels.models, developmentPlan: developmentPlan.plan, artifacts, duration: ctx.now() - startTime, metadata: { processId: 'specializations/domains/social-sciences-humanities/healthcare/healthcare-workforce-planning', timestamp: startTime, outputDir } };
}

export const wfCurrentStateTask = defineTask('wf-current-state', (args, taskCtx) => ({ kind: 'agent', title: 'Workforce Current State Analysis', agent: { name: 'workforce-analyst', prompt: { role: 'Healthcare Workforce Analyst', task: 'Analyze current workforce state', context: args, instructions: ['1. Inventory current FTEs', '2. Analyze skill mix', '3. Review turnover rates', '4. Assess vacancy rates', '5. Analyze demographics/tenure', '6. Review productivity metrics', '7. Assess labor costs', '8. Identify critical roles', '9. Benchmark against market', '10. Document current state'], outputFormat: 'JSON with current state analysis' }, outputSchema: { type: 'object', required: ['totalFTEs', 'turnoverRate', 'criticalVacancies', 'summary', 'artifacts'], properties: { totalFTEs: { type: 'number' }, turnoverRate: { type: 'number' }, criticalVacancies: { type: 'number' }, skillMix: { type: 'object' }, demographics: { type: 'object' }, summary: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'current-state', 'healthcare'] }));

export const wfDemandForecastTask = defineTask('wf-demand-forecast', (args, taskCtx) => ({ kind: 'agent', title: 'Workforce Demand Forecasting', agent: { name: 'demand-forecaster', prompt: { role: 'Workforce Demand Forecaster', task: 'Forecast workforce demand', context: args, instructions: ['1. Analyze volume projections', '2. Consider service line plans', '3. Account for productivity changes', '4. Model technology impact', '5. Consider regulatory changes', '6. Project skill requirements', '7. Model care delivery changes', '8. Consider market dynamics', '9. Create demand scenarios', '10. Document demand forecast'], outputFormat: 'JSON with demand forecast' }, outputSchema: { type: 'object', required: ['forecast', 'projections', 'artifacts'], properties: { forecast: { type: 'object' }, projections: { type: 'array', items: { type: 'object' } }, scenarios: { type: 'array', items: { type: 'object' } }, drivers: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'demand', 'healthcare'] }));

export const wfSupplyAnalysisTask = defineTask('wf-supply-analysis', (args, taskCtx) => ({ kind: 'agent', title: 'Workforce Supply Analysis', agent: { name: 'supply-analyst', prompt: { role: 'Workforce Supply Analyst', task: 'Analyze workforce supply', context: args, instructions: ['1. Project internal supply', '2. Model attrition rates', '3. Analyze retirement eligibility', '4. Project internal mobility', '5. Assess promotion potential', '6. Analyze external labor market', '7. Assess education pipeline', '8. Review competitor landscape', '9. Create supply scenarios', '10. Document supply analysis'], outputFormat: 'JSON with supply analysis' }, outputSchema: { type: 'object', required: ['supplyProjection', 'attrition', 'artifacts'], properties: { supplyProjection: { type: 'object' }, attrition: { type: 'object' }, retirementRisk: { type: 'array', items: { type: 'object' } }, laborMarket: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'supply', 'healthcare'] }));

export const wfGapAnalysisTask = defineTask('wf-gap-analysis', (args, taskCtx) => ({ kind: 'agent', title: 'Workforce Gap Analysis', agent: { name: 'gap-analyst', prompt: { role: 'Workforce Gap Analyst', task: 'Analyze workforce gaps', context: args, instructions: ['1. Calculate quantity gaps', '2. Identify skill gaps', '3. Assess competency gaps', '4. Identify critical shortfalls', '5. Identify surplus areas', '6. Prioritize gaps', '7. Calculate financial impact', '8. Identify risk areas', '9. Create gap scenarios', '10. Document gap analysis'], outputFormat: 'JSON with gap analysis' }, outputSchema: { type: 'object', required: ['shortfalls', 'surplusAreas', 'summary', 'artifacts'], properties: { shortfalls: { type: 'array', items: { type: 'object' } }, surplusAreas: { type: 'array', items: { type: 'object' } }, skillGaps: { type: 'array', items: { type: 'object' } }, financialImpact: { type: 'object' }, summary: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'gap', 'healthcare'] }));

export const wfStaffingModelsTask = defineTask('wf-staffing-models', (args, taskCtx) => ({ kind: 'agent', title: 'Staffing Models Development', agent: { name: 'staffing-specialist', prompt: { role: 'Staffing Models Specialist', task: 'Develop staffing models', context: args, instructions: ['1. Design nursing staffing model', '2. Create physician alignment model', '3. Develop APP utilization model', '4. Design support staff model', '5. Create flex staffing model', '6. Design skill mix optimization', '7. Plan technology augmentation', '8. Create contingent staffing', '9. Design productivity standards', '10. Document staffing models'], outputFormat: 'JSON with staffing models' }, outputSchema: { type: 'object', required: ['models', 'productivityStandards', 'artifacts'], properties: { models: { type: 'array', items: { type: 'object' } }, productivityStandards: { type: 'object' }, flexStrategies: { type: 'array', items: { type: 'object' } }, skillMixOptimization: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'staffing', 'healthcare'] }));

export const wfRecruitmentTask = defineTask('wf-recruitment', (args, taskCtx) => ({ kind: 'agent', title: 'Recruitment Strategy', agent: { name: 'recruitment-strategist', prompt: { role: 'Healthcare Recruitment Strategist', task: 'Develop recruitment strategy', context: args, instructions: ['1. Define recruitment priorities', '2. Design sourcing strategies', '3. Create employer branding', '4. Design candidate experience', '5. Plan pipeline development', '6. Create recruitment marketing', '7. Design interview process', '8. Plan offer strategies', '9. Design onboarding excellence', '10. Document recruitment strategy'], outputFormat: 'JSON with recruitment strategy' }, outputSchema: { type: 'object', required: ['recruitmentStrategy', 'sourcingPlan', 'artifacts'], properties: { recruitmentStrategy: { type: 'object' }, sourcingPlan: { type: 'object' }, branding: { type: 'object' }, pipelines: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'recruitment', 'healthcare'] }));

export const wfRetentionTask = defineTask('wf-retention', (args, taskCtx) => ({ kind: 'agent', title: 'Retention Strategy', agent: { name: 'retention-strategist', prompt: { role: 'Employee Retention Strategist', task: 'Develop retention strategy', context: args, instructions: ['1. Analyze turnover drivers', '2. Design engagement programs', '3. Create career pathways', '4. Design recognition programs', '5. Plan compensation strategy', '6. Design work environment', '7. Create well-being programs', '8. Design flexible work', '9. Plan leadership development', '10. Document retention strategy'], outputFormat: 'JSON with retention strategy' }, outputSchema: { type: 'object', required: ['retentionStrategy', 'programs', 'artifacts'], properties: { retentionStrategy: { type: 'object' }, programs: { type: 'array', items: { type: 'object' } }, careerPathways: { type: 'array', items: { type: 'object' } }, wellbeing: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'retention', 'healthcare'] }));

export const wfDevelopmentTask = defineTask('wf-development', (args, taskCtx) => ({ kind: 'agent', title: 'Workforce Development Plan', agent: { name: 'development-specialist', prompt: { role: 'Workforce Development Specialist', task: 'Create development plan', context: args, instructions: ['1. Design competency framework', '2. Create training programs', '3. Design clinical ladder', '4. Plan leadership development', '5. Create mentorship programs', '6. Design skill building', '7. Plan certification support', '8. Create education partnerships', '9. Design career development', '10. Document development plan'], outputFormat: 'JSON with development plan' }, outputSchema: { type: 'object', required: ['plan', 'programs', 'artifacts'], properties: { plan: { type: 'object' }, programs: { type: 'array', items: { type: 'object' } }, competencyFramework: { type: 'object' }, partnerships: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'development', 'healthcare'] }));

export const wfSuccessionTask = defineTask('wf-succession', (args, taskCtx) => ({ kind: 'agent', title: 'Succession Planning', agent: { name: 'succession-specialist', prompt: { role: 'Succession Planning Specialist', task: 'Design succession planning', context: args, instructions: ['1. Identify critical roles', '2. Assess incumbent risk', '3. Identify high potentials', '4. Create succession pools', '5. Design development paths', '6. Plan knowledge transfer', '7. Create emergency succession', '8. Design assessment process', '9. Plan review cadence', '10. Document succession planning'], outputFormat: 'JSON with succession planning' }, outputSchema: { type: 'object', required: ['successionPlan', 'criticalRoles', 'artifacts'], properties: { successionPlan: { type: 'object' }, criticalRoles: { type: 'array', items: { type: 'object' } }, successionPools: { type: 'array', items: { type: 'object' } }, developmentPaths: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'succession', 'healthcare'] }));

export const wfImplementationTask = defineTask('wf-implementation', (args, taskCtx) => ({ kind: 'agent', title: 'Workforce Plan Implementation', agent: { name: 'implementation-manager', prompt: { role: 'Workforce Implementation Manager', task: 'Plan workforce implementation', context: args, instructions: ['1. Create implementation timeline', '2. Define resource requirements', '3. Plan technology enablement', '4. Design change management', '5. Create communication plan', '6. Define success metrics', '7. Plan risk mitigation', '8. Create governance structure', '9. Design monitoring process', '10. Document implementation'], outputFormat: 'JSON with implementation plan' }, outputSchema: { type: 'object', required: ['plan', 'timeline', 'artifacts'], properties: { plan: { type: 'object' }, timeline: { type: 'object' }, resources: { type: 'object' }, governance: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'implementation', 'healthcare'] }));

export const wfDocumentationTask = defineTask('wf-documentation', (args, taskCtx) => ({ kind: 'agent', title: 'Workforce Plan Documentation', agent: { name: 'documentation-writer', prompt: { role: 'Workforce Plan Writer', task: 'Document workforce plan', context: args, instructions: ['1. Write executive summary', '2. Document current state', '3. Include demand forecast', '4. Document supply analysis', '5. Include gap analysis', '6. Document staffing models', '7. Include recruitment strategy', '8. Document development plan', '9. Include implementation', '10. Format professionally'], outputFormat: 'JSON with documentation' }, outputSchema: { type: 'object', required: ['documentPath', 'artifacts'], properties: { documentPath: { type: 'string' }, summary: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'workforce', 'documentation', 'healthcare'] }));
