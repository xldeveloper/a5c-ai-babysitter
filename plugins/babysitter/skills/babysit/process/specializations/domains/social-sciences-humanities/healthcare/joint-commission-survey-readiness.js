/**
 * @process specializations/domains/social-sciences-humanities/healthcare/joint-commission-survey-readiness
 * @description Joint Commission Survey Readiness - Comprehensive preparation framework for achieving
 * and maintaining Joint Commission accreditation through continuous standards compliance.
 * @inputs { organizationName: string, accreditationType?: string, surveyWindow?: object, focusAreas?: array }
 * @outputs { success: boolean, readinessAssessment: object, actionPlan: object, tracers: array, artifacts: array }
 */

import { defineTask } from '@a5c-ai/babysitter-sdk';

export async function process(inputs, ctx) {
  const { organizationName, accreditationType = 'hospital', surveyWindow = {}, focusAreas = [], outputDir = 'joint-commission-output' } = inputs;
  const startTime = ctx.now();
  const artifacts = [];

  ctx.log('info', `Starting Joint Commission Survey Readiness for: ${organizationName}`);

  const standardsAssessment = await ctx.task(jcStandardsAssessmentTask, { organizationName, accreditationType, focusAreas, outputDir });
  artifacts.push(...standardsAssessment.artifacts);

  await ctx.breakpoint({ question: `Standards assessment complete. Compliance score: ${standardsAssessment.complianceScore}%. ${standardsAssessment.criticalFindings.length} critical findings. Proceed?`, title: 'Standards Assessment Review', context: { runId: ctx.runId, score: standardsAssessment.complianceScore, critical: standardsAssessment.criticalFindings } });

  const npsgsCompliance = await ctx.task(jcNPSGsTask, { accreditationType, outputDir });
  artifacts.push(...npsgsCompliance.artifacts);

  const tracerProgram = await ctx.task(jcTracerTask, { standardsAssessment, accreditationType, outputDir });
  artifacts.push(...tracerProgram.artifacts);

  const documentCompliance = await ctx.task(jcDocumentationTask, { standardsAssessment, outputDir });
  artifacts.push(...documentCompliance.artifacts);

  await ctx.breakpoint({ question: `Tracer program designed with ${tracerProgram.tracerTypes.length} tracer types. ${documentCompliance.documentsReviewed} documents reviewed. Proceed with staff preparation?`, title: 'Tracer Program Review', context: { runId: ctx.runId, tracers: tracerProgram.tracerTypes, documents: documentCompliance.gaps } });

  const staffPreparation = await ctx.task(jcStaffPrepTask, { standardsAssessment, tracerProgram, outputDir });
  artifacts.push(...staffPreparation.artifacts);

  const environmentOfCare = await ctx.task(jcEOCTask, { standardsAssessment, outputDir });
  artifacts.push(...environmentOfCare.artifacts);

  const dataManagement = await ctx.task(jcDataTask, { accreditationType, outputDir });
  artifacts.push(...dataManagement.artifacts);

  const mockSurvey = await ctx.task(jcMockSurveyTask, { standardsAssessment, tracerProgram, outputDir });
  artifacts.push(...mockSurvey.artifacts);

  const actionPlan = await ctx.task(jcActionPlanTask, { standardsAssessment, npsgsCompliance, documentCompliance, environmentOfCare, outputDir });
  artifacts.push(...actionPlan.artifacts);

  const finalDocumentation = await ctx.task(jcFinalDocTask, { organizationName, standardsAssessment, npsgsCompliance, tracerProgram, documentCompliance, staffPreparation, environmentOfCare, dataManagement, mockSurvey, actionPlan, outputDir });
  artifacts.push(...finalDocumentation.artifacts);

  return { success: true, organizationName, readinessAssessment: { complianceScore: standardsAssessment.complianceScore, criticalFindings: standardsAssessment.criticalFindings, npsgsStatus: npsgsCompliance.status }, actionPlan: actionPlan.plan, tracers: tracerProgram.tracerTypes, artifacts, duration: ctx.now() - startTime, metadata: { processId: 'specializations/domains/social-sciences-humanities/healthcare/joint-commission-survey-readiness', timestamp: startTime, outputDir } };
}

export const jcStandardsAssessmentTask = defineTask('jc-standards-assessment', (args, taskCtx) => ({ kind: 'agent', title: 'Joint Commission Standards Assessment', agent: { name: 'jc-surveyor', prompt: { role: 'Joint Commission Standards Expert', task: 'Assess standards compliance', context: args, instructions: ['1. Review all applicable chapters', '2. Assess Leadership (LD) standards', '3. Review Human Resources (HR)', '4. Assess Provision of Care (PC)', '5. Review Medication Management (MM)', '6. Assess Infection Control (IC)', '7. Review Environment of Care (EC)', '8. Assess Life Safety (LS)', '9. Identify critical findings', '10. Calculate compliance score'], outputFormat: 'JSON with standards assessment' }, outputSchema: { type: 'object', required: ['complianceScore', 'criticalFindings', 'artifacts'], properties: { complianceScore: { type: 'number' }, criticalFindings: { type: 'array', items: { type: 'object' } }, chapterScores: { type: 'object' }, gaps: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'joint-commission', 'standards', 'healthcare'] }));

export const jcNPSGsTask = defineTask('jc-npsgs', (args, taskCtx) => ({ kind: 'agent', title: 'National Patient Safety Goals Assessment', agent: { name: 'patient-safety-specialist', prompt: { role: 'Patient Safety Goals Specialist', task: 'Assess NPSG compliance', context: args, instructions: ['1. Review patient identification', '2. Assess communication effectiveness', '3. Review medication safety', '4. Assess infection prevention', '5. Review falls prevention', '6. Assess clinical alarms', '7. Review suicide prevention', '8. Assess anticoagulation safety', '9. Document compliance status', '10. Identify improvement needs'], outputFormat: 'JSON with NPSG assessment' }, outputSchema: { type: 'object', required: ['status', 'npsgCompliance', 'artifacts'], properties: { status: { type: 'string' }, npsgCompliance: { type: 'array', items: { type: 'object' } }, gaps: { type: 'array', items: { type: 'object' } }, actionItems: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'joint-commission', 'npsgs', 'healthcare'] }));

export const jcTracerTask = defineTask('jc-tracer', (args, taskCtx) => ({ kind: 'agent', title: 'Tracer Program Design', agent: { name: 'tracer-specialist', prompt: { role: 'Tracer Program Specialist', task: 'Design tracer methodology program', context: args, instructions: ['1. Design individual tracers', '2. Create system tracers', '3. Design program-specific tracers', '4. Develop tracer questions', '5. Create observation guides', '6. Design tracer schedules', '7. Create tracer documentation', '8. Design tracer training', '9. Plan tracer frequency', '10. Document tracer program'], outputFormat: 'JSON with tracer program' }, outputSchema: { type: 'object', required: ['tracerTypes', 'questions', 'artifacts'], properties: { tracerTypes: { type: 'array', items: { type: 'object' } }, questions: { type: 'array', items: { type: 'object' } }, schedule: { type: 'object' }, training: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'joint-commission', 'tracer', 'healthcare'] }));

export const jcDocumentationTask = defineTask('jc-documentation-review', (args, taskCtx) => ({ kind: 'agent', title: 'Document Review and Compliance', agent: { name: 'documentation-specialist', prompt: { role: 'Documentation Compliance Specialist', task: 'Review documentation compliance', context: args, instructions: ['1. Review policies and procedures', '2. Assess medical record compliance', '3. Review credentialing documents', '4. Assess competency documentation', '5. Review contract compliance', '6. Assess meeting minutes', '7. Review performance data', '8. Assess quality reports', '9. Identify documentation gaps', '10. Document review findings'], outputFormat: 'JSON with documentation review' }, outputSchema: { type: 'object', required: ['documentsReviewed', 'gaps', 'artifacts'], properties: { documentsReviewed: { type: 'number' }, gaps: { type: 'array', items: { type: 'object' } }, recommendations: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'joint-commission', 'documentation', 'healthcare'] }));

export const jcStaffPrepTask = defineTask('jc-staff-prep', (args, taskCtx) => ({ kind: 'agent', title: 'Staff Survey Preparation', agent: { name: 'staff-preparation-specialist', prompt: { role: 'Staff Preparation Specialist', task: 'Design staff preparation program', context: args, instructions: ['1. Create education curriculum', '2. Design department-specific training', '3. Develop key talking points', '4. Create question-and-answer guides', '5. Design mock interview process', '6. Create competency validation', '7. Develop communication plan', '8. Design just-in-time training', '9. Create staff resources', '10. Document preparation program'], outputFormat: 'JSON with staff preparation' }, outputSchema: { type: 'object', required: ['preparationProgram', 'training', 'artifacts'], properties: { preparationProgram: { type: 'object' }, training: { type: 'array', items: { type: 'object' } }, talkingPoints: { type: 'array', items: { type: 'object' } }, resources: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'joint-commission', 'staff-prep', 'healthcare'] }));

export const jcEOCTask = defineTask('jc-eoc', (args, taskCtx) => ({ kind: 'agent', title: 'Environment of Care Assessment', agent: { name: 'eoc-specialist', prompt: { role: 'Environment of Care Specialist', task: 'Assess environment of care compliance', context: args, instructions: ['1. Conduct facility walkthrough', '2. Assess fire safety compliance', '3. Review hazardous materials', '4. Assess emergency management', '5. Review security management', '6. Assess medical equipment', '7. Review utility systems', '8. Assess infection prevention', '9. Identify physical environment gaps', '10. Document EOC findings'], outputFormat: 'JSON with EOC assessment' }, outputSchema: { type: 'object', required: ['eocFindings', 'lifeSafety', 'artifacts'], properties: { eocFindings: { type: 'array', items: { type: 'object' } }, lifeSafety: { type: 'object' }, emergencyManagement: { type: 'object' }, recommendations: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'joint-commission', 'eoc', 'healthcare'] }));

export const jcDataTask = defineTask('jc-data', (args, taskCtx) => ({ kind: 'agent', title: 'Data Management and ORYX', agent: { name: 'data-specialist', prompt: { role: 'Performance Data Specialist', task: 'Assess data management and ORYX', context: args, instructions: ['1. Review ORYX measure compliance', '2. Assess data collection processes', '3. Review data accuracy', '4. Assess performance improvement', '5. Review quality dashboards', '6. Assess action plan effectiveness', '7. Review benchmark comparison', '8. Assess data reporting', '9. Identify data gaps', '10. Document data assessment'], outputFormat: 'JSON with data assessment' }, outputSchema: { type: 'object', required: ['dataAssessment', 'oryxCompliance', 'artifacts'], properties: { dataAssessment: { type: 'object' }, oryxCompliance: { type: 'array', items: { type: 'object' } }, performance: { type: 'object' }, gaps: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'joint-commission', 'data', 'healthcare'] }));

export const jcMockSurveyTask = defineTask('jc-mock-survey', (args, taskCtx) => ({ kind: 'agent', title: 'Mock Survey Planning', agent: { name: 'mock-survey-specialist', prompt: { role: 'Mock Survey Specialist', task: 'Plan and design mock survey', context: args, instructions: ['1. Design mock survey agenda', '2. Create surveyor assignments', '3. Design document request', '4. Plan tracer execution', '5. Create interview schedules', '6. Design observation protocol', '7. Plan opening/closing conference', '8. Create finding documentation', '9. Design corrective action process', '10. Document mock survey plan'], outputFormat: 'JSON with mock survey plan' }, outputSchema: { type: 'object', required: ['surveyPlan', 'agenda', 'artifacts'], properties: { surveyPlan: { type: 'object' }, agenda: { type: 'object' }, tracers: { type: 'array', items: { type: 'object' } }, documentRequest: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'joint-commission', 'mock-survey', 'healthcare'] }));

export const jcActionPlanTask = defineTask('jc-action-plan', (args, taskCtx) => ({ kind: 'agent', title: 'Survey Readiness Action Plan', agent: { name: 'action-plan-specialist', prompt: { role: 'Action Plan Specialist', task: 'Create survey readiness action plan', context: args, instructions: ['1. Prioritize findings', '2. Assign responsibility', '3. Create timelines', '4. Define resources needed', '5. Create quick-win list', '6. Design escalation process', '7. Create tracking system', '8. Define success criteria', '9. Plan status reporting', '10. Document action plan'], outputFormat: 'JSON with action plan' }, outputSchema: { type: 'object', required: ['plan', 'priorities', 'artifacts'], properties: { plan: { type: 'object' }, priorities: { type: 'array', items: { type: 'object' } }, timeline: { type: 'object' }, tracking: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'joint-commission', 'action-plan', 'healthcare'] }));

export const jcFinalDocTask = defineTask('jc-final-documentation', (args, taskCtx) => ({ kind: 'agent', title: 'Survey Readiness Documentation', agent: { name: 'documentation-writer', prompt: { role: 'Survey Readiness Documentation Writer', task: 'Document survey readiness program', context: args, instructions: ['1. Write executive summary', '2. Document standards assessment', '3. Include NPSG compliance', '4. Document tracer program', '5. Include staff preparation', '6. Document EOC assessment', '7. Include data management', '8. Document mock survey plan', '9. Include action plan', '10. Format professionally'], outputFormat: 'JSON with documentation' }, outputSchema: { type: 'object', required: ['documentPath', 'artifacts'], properties: { documentPath: { type: 'string' }, summary: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'joint-commission', 'documentation', 'healthcare'] }));
