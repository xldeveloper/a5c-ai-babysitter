/**
 * @process specializations/domains/social-sciences-humanities/healthcare/service-line-strategic-planning
 * @description Service Line Strategic Planning - Comprehensive methodology for developing, evaluating,
 * and implementing healthcare service line strategies aligned with organizational objectives.
 * @inputs { organizationName: string, serviceLine: string, planningHorizon?: number, marketData?: object }
 * @outputs { success: boolean, strategicPlan: object, financialProforma: object, implementationRoadmap: object, artifacts: array }
 */

import { defineTask } from '@a5c-ai/babysitter-sdk';

export async function process(inputs, ctx) {
  const { organizationName, serviceLine, planningHorizon = 5, marketData = {}, outputDir = 'service-line-output' } = inputs;
  const startTime = ctx.now();
  const artifacts = [];

  ctx.log('info', `Starting Service Line Strategic Planning for: ${organizationName} - ${serviceLine}`);

  const marketAnalysis = await ctx.task(slMarketAnalysisTask, { organizationName, serviceLine, marketData, outputDir });
  artifacts.push(...marketAnalysis.artifacts);

  await ctx.breakpoint({ question: `Market analysis complete. Market size: ${marketAnalysis.marketSize}. Growth rate: ${marketAnalysis.growthRate}%. Competitive position: ${marketAnalysis.competitivePosition}. Proceed?`, title: 'Market Analysis Review', context: { runId: ctx.runId, market: marketAnalysis.summary } });

  const internalAssessment = await ctx.task(slInternalAssessmentTask, { serviceLine, organizationName, outputDir });
  artifacts.push(...internalAssessment.artifacts);

  const swotAnalysis = await ctx.task(slSWOTTask, { marketAnalysis, internalAssessment, outputDir });
  artifacts.push(...swotAnalysis.artifacts);

  const strategicOptions = await ctx.task(slStrategicOptionsTask, { swotAnalysis, marketAnalysis, planningHorizon, outputDir });
  artifacts.push(...strategicOptions.artifacts);

  await ctx.breakpoint({ question: `${strategicOptions.options.length} strategic options developed. Top option: ${strategicOptions.recommendedOption}. Proceed with financial modeling?`, title: 'Strategic Options Review', context: { runId: ctx.runId, options: strategicOptions.options, recommended: strategicOptions.recommendedOption } });

  const financialProforma = await ctx.task(slFinancialProformaTask, { strategicOptions, planningHorizon, outputDir });
  artifacts.push(...financialProforma.artifacts);

  const operationalPlan = await ctx.task(slOperationalPlanTask, { strategicOptions, internalAssessment, outputDir });
  artifacts.push(...operationalPlan.artifacts);

  const physicianStrategy = await ctx.task(slPhysicianStrategyTask, { serviceLine, strategicOptions, outputDir });
  artifacts.push(...physicianStrategy.artifacts);

  const riskAssessment = await ctx.task(slRiskAssessmentTask, { strategicOptions, financialProforma, outputDir });
  artifacts.push(...riskAssessment.artifacts);

  const implementationRoadmap = await ctx.task(slImplementationTask, { strategicOptions, financialProforma, operationalPlan, outputDir });
  artifacts.push(...implementationRoadmap.artifacts);

  const documentation = await ctx.task(slDocumentationTask, { organizationName, serviceLine, marketAnalysis, internalAssessment, swotAnalysis, strategicOptions, financialProforma, operationalPlan, physicianStrategy, riskAssessment, implementationRoadmap, outputDir });
  artifacts.push(...documentation.artifacts);

  return { success: true, organizationName, serviceLine, strategicPlan: { vision: strategicOptions.vision, strategy: strategicOptions.recommendedOption, objectives: strategicOptions.objectives }, financialProforma: financialProforma.proforma, implementationRoadmap: implementationRoadmap.roadmap, artifacts, duration: ctx.now() - startTime, metadata: { processId: 'specializations/domains/social-sciences-humanities/healthcare/service-line-strategic-planning', timestamp: startTime, outputDir } };
}

export const slMarketAnalysisTask = defineTask('sl-market-analysis', (args, taskCtx) => ({ kind: 'agent', title: 'Service Line Market Analysis', agent: { name: 'market-analyst', prompt: { role: 'Healthcare Market Analyst', task: 'Conduct service line market analysis', context: args, instructions: ['1. Define market geography', '2. Calculate market size and growth', '3. Analyze competitive landscape', '4. Assess market share', '5. Identify referral patterns', '6. Analyze payer mix trends', '7. Review demographic trends', '8. Assess regulatory environment', '9. Identify market opportunities', '10. Document market analysis'], outputFormat: 'JSON with market analysis' }, outputSchema: { type: 'object', required: ['marketSize', 'growthRate', 'competitivePosition', 'summary', 'artifacts'], properties: { marketSize: { type: 'string' }, growthRate: { type: 'number' }, competitivePosition: { type: 'string' }, competitors: { type: 'array', items: { type: 'object' } }, opportunities: { type: 'array', items: { type: 'object' } }, summary: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'service-line', 'market', 'healthcare'] }));

export const slInternalAssessmentTask = defineTask('sl-internal-assessment', (args, taskCtx) => ({ kind: 'agent', title: 'Internal Assessment', agent: { name: 'internal-analyst', prompt: { role: 'Internal Assessment Analyst', task: 'Assess internal capabilities', context: args, instructions: ['1. Assess clinical capabilities', '2. Review quality metrics', '3. Analyze volume trends', '4. Assess physician capacity', '5. Review facility capacity', '6. Analyze financial performance', '7. Assess technology capabilities', '8. Review staff competencies', '9. Identify core competencies', '10. Document internal assessment'], outputFormat: 'JSON with internal assessment' }, outputSchema: { type: 'object', required: ['capabilities', 'performance', 'artifacts'], properties: { capabilities: { type: 'array', items: { type: 'object' } }, performance: { type: 'object' }, quality: { type: 'object' }, capacity: { type: 'object' }, strengths: { type: 'array', items: { type: 'object' } }, weaknesses: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'service-line', 'internal', 'healthcare'] }));

export const slSWOTTask = defineTask('sl-swot', (args, taskCtx) => ({ kind: 'agent', title: 'SWOT Analysis', agent: { name: 'strategy-analyst', prompt: { role: 'Strategy Analyst', task: 'Conduct SWOT analysis', context: args, instructions: ['1. Synthesize strengths', '2. Identify weaknesses', '3. Catalog opportunities', '4. Identify threats', '5. Develop SO strategies', '6. Develop WO strategies', '7. Develop ST strategies', '8. Develop WT strategies', '9. Prioritize strategic issues', '10. Document SWOT analysis'], outputFormat: 'JSON with SWOT analysis' }, outputSchema: { type: 'object', required: ['swot', 'strategies', 'artifacts'], properties: { swot: { type: 'object' }, strategies: { type: 'array', items: { type: 'object' } }, prioritizedIssues: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'service-line', 'swot', 'healthcare'] }));

export const slStrategicOptionsTask = defineTask('sl-strategic-options', (args, taskCtx) => ({ kind: 'agent', title: 'Strategic Options Development', agent: { name: 'strategy-developer', prompt: { role: 'Strategic Planning Specialist', task: 'Develop strategic options', context: args, instructions: ['1. Define service line vision', '2. Develop growth strategies', '3. Consider differentiation options', '4. Evaluate partnership options', '5. Assess new program opportunities', '6. Develop exit strategies', '7. Evaluate each option', '8. Create decision matrix', '9. Recommend optimal strategy', '10. Document strategic options'], outputFormat: 'JSON with strategic options' }, outputSchema: { type: 'object', required: ['vision', 'options', 'recommendedOption', 'objectives', 'artifacts'], properties: { vision: { type: 'string' }, options: { type: 'array', items: { type: 'object' } }, recommendedOption: { type: 'string' }, objectives: { type: 'array', items: { type: 'object' } }, decisionMatrix: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'service-line', 'strategy', 'healthcare'] }));

export const slFinancialProformaTask = defineTask('sl-financial-proforma', (args, taskCtx) => ({ kind: 'agent', title: 'Financial Proforma Development', agent: { name: 'financial-analyst', prompt: { role: 'Healthcare Financial Analyst', task: 'Develop financial proforma', context: args, instructions: ['1. Project volume growth', '2. Estimate revenue growth', '3. Project expense changes', '4. Calculate capital requirements', '5. Develop staffing model', '6. Calculate contribution margin', '7. Project ROI/payback', '8. Develop sensitivity analysis', '9. Create break-even analysis', '10. Document financial proforma'], outputFormat: 'JSON with financial proforma' }, outputSchema: { type: 'object', required: ['proforma', 'roi', 'artifacts'], properties: { proforma: { type: 'object' }, volumeProjections: { type: 'object' }, revenueProjections: { type: 'object' }, capitalRequirements: { type: 'number' }, roi: { type: 'object' }, sensitivity: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'service-line', 'financial', 'healthcare'] }));

export const slOperationalPlanTask = defineTask('sl-operational-plan', (args, taskCtx) => ({ kind: 'agent', title: 'Operational Plan Development', agent: { name: 'operations-planner', prompt: { role: 'Healthcare Operations Planner', task: 'Develop operational plan', context: args, instructions: ['1. Define facility requirements', '2. Plan equipment needs', '3. Develop staffing plan', '4. Design workflows', '5. Plan technology needs', '6. Define quality metrics', '7. Plan patient experience', '8. Design access strategy', '9. Plan marketing approach', '10. Document operational plan'], outputFormat: 'JSON with operational plan' }, outputSchema: { type: 'object', required: ['operationalPlan', 'staffing', 'artifacts'], properties: { operationalPlan: { type: 'object' }, facilityPlan: { type: 'object' }, staffing: { type: 'object' }, workflows: { type: 'array', items: { type: 'object' } }, technology: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'service-line', 'operations', 'healthcare'] }));

export const slPhysicianStrategyTask = defineTask('sl-physician-strategy', (args, taskCtx) => ({ kind: 'agent', title: 'Physician Strategy', agent: { name: 'physician-strategist', prompt: { role: 'Physician Relations Strategist', task: 'Develop physician strategy', context: args, instructions: ['1. Assess current physician base', '2. Project physician needs', '3. Develop recruitment plan', '4. Plan alignment strategies', '5. Design compensation models', '6. Plan leadership development', '7. Design governance structure', '8. Plan referral network', '9. Assess employed vs independent', '10. Document physician strategy'], outputFormat: 'JSON with physician strategy' }, outputSchema: { type: 'object', required: ['physicianStrategy', 'recruitment', 'artifacts'], properties: { physicianStrategy: { type: 'object' }, currentState: { type: 'object' }, recruitment: { type: 'object' }, alignment: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'service-line', 'physician', 'healthcare'] }));

export const slRiskAssessmentTask = defineTask('sl-risk-assessment', (args, taskCtx) => ({ kind: 'agent', title: 'Strategic Risk Assessment', agent: { name: 'risk-analyst', prompt: { role: 'Strategic Risk Analyst', task: 'Assess strategic risks', context: args, instructions: ['1. Identify strategic risks', '2. Assess market risks', '3. Evaluate financial risks', '4. Assess operational risks', '5. Identify regulatory risks', '6. Assess competitive risks', '7. Calculate risk impact', '8. Develop mitigation strategies', '9. Create contingency plans', '10. Document risk assessment'], outputFormat: 'JSON with risk assessment' }, outputSchema: { type: 'object', required: ['risks', 'mitigationStrategies', 'artifacts'], properties: { risks: { type: 'array', items: { type: 'object' } }, mitigationStrategies: { type: 'array', items: { type: 'object' } }, contingencyPlans: { type: 'array', items: { type: 'object' } }, riskMatrix: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'service-line', 'risk', 'healthcare'] }));

export const slImplementationTask = defineTask('sl-implementation', (args, taskCtx) => ({ kind: 'agent', title: 'Implementation Roadmap', agent: { name: 'implementation-planner', prompt: { role: 'Implementation Planner', task: 'Create implementation roadmap', context: args, instructions: ['1. Define implementation phases', '2. Create milestone schedule', '3. Assign accountability', '4. Define resource needs', '5. Create governance structure', '6. Design communication plan', '7. Define success metrics', '8. Create risk mitigation', '9. Plan quick wins', '10. Document implementation roadmap'], outputFormat: 'JSON with implementation roadmap' }, outputSchema: { type: 'object', required: ['roadmap', 'phases', 'artifacts'], properties: { roadmap: { type: 'object' }, phases: { type: 'array', items: { type: 'object' } }, milestones: { type: 'array', items: { type: 'object' } }, governance: { type: 'object' }, metrics: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'service-line', 'implementation', 'healthcare'] }));

export const slDocumentationTask = defineTask('sl-documentation', (args, taskCtx) => ({ kind: 'agent', title: 'Strategic Plan Documentation', agent: { name: 'documentation-writer', prompt: { role: 'Strategic Plan Writer', task: 'Document service line strategic plan', context: args, instructions: ['1. Write executive summary', '2. Document market analysis', '3. Include internal assessment', '4. Document SWOT analysis', '5. Include strategic options', '6. Document financial proforma', '7. Include operational plan', '8. Document physician strategy', '9. Include implementation roadmap', '10. Format professionally'], outputFormat: 'JSON with documentation' }, outputSchema: { type: 'object', required: ['documentPath', 'artifacts'], properties: { documentPath: { type: 'string' }, summary: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'service-line', 'documentation', 'healthcare'] }));
