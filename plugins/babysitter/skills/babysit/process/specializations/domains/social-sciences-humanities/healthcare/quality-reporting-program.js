/**
 * @process specializations/domains/social-sciences-humanities/healthcare/quality-reporting-program
 * @description Quality Reporting Program Compliance - Framework for managing CMS quality reporting
 * programs including MIPS, Hospital IQR, VBP, and other value-based payment programs.
 * @inputs { organizationName: string, reportingPrograms?: array, providerType?: string, currentPerformance?: object }
 * @outputs { success: boolean, programCompliance: object, improvementPlan: object, metrics: array, artifacts: array }
 */

import { defineTask } from '@a5c-ai/babysitter-sdk';

export async function process(inputs, ctx) {
  const { organizationName, reportingPrograms = ['hospital-iqr', 'vbp'], providerType = 'hospital', currentPerformance = {}, outputDir = 'quality-reporting-output' } = inputs;
  const startTime = ctx.now();
  const artifacts = [];

  ctx.log('info', `Starting Quality Reporting Program Compliance for: ${organizationName}`);

  const programAssessment = await ctx.task(qrpAssessmentTask, { organizationName, reportingPrograms, providerType, currentPerformance, outputDir });
  artifacts.push(...programAssessment.artifacts);

  await ctx.breakpoint({ question: `Program assessment complete. Overall compliance: ${programAssessment.overallCompliance}%. ${programAssessment.atRiskMeasures.length} measures at risk. Proceed?`, title: 'QRP Assessment Review', context: { runId: ctx.runId, compliance: programAssessment.overallCompliance, atRisk: programAssessment.atRiskMeasures } });

  const measureSelection = await ctx.task(qrpMeasureSelectionTask, { programAssessment, reportingPrograms, outputDir });
  artifacts.push(...measureSelection.artifacts);

  const dataInfrastructure = await ctx.task(qrpDataInfrastructureTask, { measureSelection, outputDir });
  artifacts.push(...dataInfrastructure.artifacts);

  const ecqmCompliance = await ctx.task(qrpECQMTask, { measureSelection, outputDir });
  artifacts.push(...ecqmCompliance.artifacts);

  await ctx.breakpoint({ question: `${measureSelection.selectedMeasures.length} measures selected. Data infrastructure ${dataInfrastructure.readinessScore}% ready. Proceed with improvement planning?`, title: 'Measure and Data Review', context: { runId: ctx.runId, measures: measureSelection.selectedMeasures, readiness: dataInfrastructure.readinessScore } });

  const performanceImprovement = await ctx.task(qrpPerformanceImprovementTask, { programAssessment, measureSelection, outputDir });
  artifacts.push(...performanceImprovement.artifacts);

  const submissionManagement = await ctx.task(qrpSubmissionTask, { measureSelection, dataInfrastructure, outputDir });
  artifacts.push(...submissionManagement.artifacts);

  const incentiveCalculation = await ctx.task(qrpIncentiveTask, { programAssessment, currentPerformance, outputDir });
  artifacts.push(...incentiveCalculation.artifacts);

  const governanceStructure = await ctx.task(qrpGovernanceTask, { reportingPrograms, outputDir });
  artifacts.push(...governanceStructure.artifacts);

  const implementationPlan = await ctx.task(qrpImplementationTask, { measureSelection, dataInfrastructure, performanceImprovement, outputDir });
  artifacts.push(...implementationPlan.artifacts);

  const documentation = await ctx.task(qrpDocumentationTask, { organizationName, programAssessment, measureSelection, dataInfrastructure, ecqmCompliance, performanceImprovement, submissionManagement, incentiveCalculation, governanceStructure, implementationPlan, outputDir });
  artifacts.push(...documentation.artifacts);

  return { success: true, organizationName, programCompliance: { programs: reportingPrograms, compliance: programAssessment.overallCompliance, measures: measureSelection.selectedMeasures }, improvementPlan: performanceImprovement.plan, metrics: programAssessment.measurePerformance, artifacts, duration: ctx.now() - startTime, metadata: { processId: 'specializations/domains/social-sciences-humanities/healthcare/quality-reporting-program', timestamp: startTime, outputDir } };
}

export const qrpAssessmentTask = defineTask('qrp-assessment', (args, taskCtx) => ({ kind: 'agent', title: 'Quality Reporting Program Assessment', agent: { name: 'qrp-analyst', prompt: { role: 'Quality Reporting Program Analyst', task: 'Assess quality reporting compliance', context: args, instructions: ['1. Identify applicable programs', '2. Review current measure performance', '3. Assess submission compliance', '4. Identify at-risk measures', '5. Review historical performance', '6. Assess benchmark standing', '7. Calculate payment impact', '8. Review data accuracy', '9. Identify improvement opportunities', '10. Document assessment findings'], outputFormat: 'JSON with program assessment' }, outputSchema: { type: 'object', required: ['overallCompliance', 'atRiskMeasures', 'artifacts'], properties: { overallCompliance: { type: 'number' }, atRiskMeasures: { type: 'array', items: { type: 'object' } }, measurePerformance: { type: 'array', items: { type: 'object' } }, programStatus: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'quality-reporting', 'assessment', 'healthcare'] }));

export const qrpMeasureSelectionTask = defineTask('qrp-measure-selection', (args, taskCtx) => ({ kind: 'agent', title: 'Quality Measure Selection', agent: { name: 'measure-specialist', prompt: { role: 'Quality Measure Specialist', task: 'Optimize measure selection', context: args, instructions: ['1. Review available measures', '2. Analyze performance potential', '3. Assess data feasibility', '4. Consider strategic alignment', '5. Evaluate measure weighting', '6. Review reporting burden', '7. Plan measure mix optimization', '8. Consider topped-out measures', '9. Plan MIPS category strategy', '10. Document measure selection'], outputFormat: 'JSON with measure selection' }, outputSchema: { type: 'object', required: ['selectedMeasures', 'strategy', 'artifacts'], properties: { selectedMeasures: { type: 'array', items: { type: 'object' } }, strategy: { type: 'object' }, categoryDistribution: { type: 'object' }, rationale: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'quality-reporting', 'measures', 'healthcare'] }));

export const qrpDataInfrastructureTask = defineTask('qrp-data-infrastructure', (args, taskCtx) => ({ kind: 'agent', title: 'Data Infrastructure Assessment', agent: { name: 'data-infrastructure-specialist', prompt: { role: 'Data Infrastructure Specialist', task: 'Assess and plan data infrastructure', context: args, instructions: ['1. Assess EHR capabilities', '2. Review data capture workflows', '3. Assess data quality', '4. Review integration needs', '5. Assess registry connections', '6. Plan data validation', '7. Design data governance', '8. Plan automation opportunities', '9. Calculate readiness score', '10. Document infrastructure plan'], outputFormat: 'JSON with data infrastructure' }, outputSchema: { type: 'object', required: ['readinessScore', 'infrastructure', 'artifacts'], properties: { readinessScore: { type: 'number' }, infrastructure: { type: 'object' }, dataFlows: { type: 'array', items: { type: 'object' } }, gaps: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'quality-reporting', 'data', 'healthcare'] }));

export const qrpECQMTask = defineTask('qrp-ecqm', (args, taskCtx) => ({ kind: 'agent', title: 'eCQM Compliance', agent: { name: 'ecqm-specialist', prompt: { role: 'eCQM Specialist', task: 'Assess eCQM compliance', context: args, instructions: ['1. Review eCQM requirements', '2. Assess EHR measure build', '3. Validate measure logic', '4. Review data capture', '5. Test QRDA export', '6. Assess value set compliance', '7. Review measure testing', '8. Plan validation testing', '9. Assess submission readiness', '10. Document eCQM compliance'], outputFormat: 'JSON with eCQM assessment' }, outputSchema: { type: 'object', required: ['ecqmStatus', 'measures', 'artifacts'], properties: { ecqmStatus: { type: 'string' }, measures: { type: 'array', items: { type: 'object' } }, validationResults: { type: 'object' }, gaps: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'quality-reporting', 'ecqm', 'healthcare'] }));

export const qrpPerformanceImprovementTask = defineTask('qrp-performance-improvement', (args, taskCtx) => ({ kind: 'agent', title: 'Performance Improvement Planning', agent: { name: 'performance-improvement-specialist', prompt: { role: 'Performance Improvement Specialist', task: 'Plan quality performance improvement', context: args, instructions: ['1. Identify priority measures', '2. Analyze performance gaps', '3. Design interventions', '4. Create improvement projects', '5. Define success metrics', '6. Plan clinical engagement', '7. Design feedback mechanisms', '8. Create monitoring plan', '9. Plan sustainability', '10. Document improvement plan'], outputFormat: 'JSON with improvement plan' }, outputSchema: { type: 'object', required: ['plan', 'interventions', 'artifacts'], properties: { plan: { type: 'object' }, interventions: { type: 'array', items: { type: 'object' } }, projects: { type: 'array', items: { type: 'object' } }, metrics: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'quality-reporting', 'improvement', 'healthcare'] }));

export const qrpSubmissionTask = defineTask('qrp-submission', (args, taskCtx) => ({ kind: 'agent', title: 'Data Submission Management', agent: { name: 'submission-specialist', prompt: { role: 'Quality Submission Specialist', task: 'Manage data submission process', context: args, instructions: ['1. Define submission methods', '2. Create submission calendar', '3. Design validation process', '4. Plan attestation process', '5. Create error resolution', '6. Design submission tracking', '7. Plan resubmission process', '8. Create documentation', '9. Design audit trail', '10. Document submission process'], outputFormat: 'JSON with submission process' }, outputSchema: { type: 'object', required: ['submissionProcess', 'calendar', 'artifacts'], properties: { submissionProcess: { type: 'object' }, calendar: { type: 'object' }, validation: { type: 'object' }, tracking: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'quality-reporting', 'submission', 'healthcare'] }));

export const qrpIncentiveTask = defineTask('qrp-incentive', (args, taskCtx) => ({ kind: 'agent', title: 'Payment Incentive Calculation', agent: { name: 'incentive-analyst', prompt: { role: 'Payment Incentive Analyst', task: 'Calculate payment incentives', context: args, instructions: ['1. Calculate MIPS score', '2. Estimate VBP adjustment', '3. Calculate HAC penalties', '4. Estimate HRRP impact', '5. Calculate total impact', '6. Model improvement scenarios', '7. Benchmark against peers', '8. Project future impact', '9. Create financial dashboard', '10. Document calculations'], outputFormat: 'JSON with incentive calculations' }, outputSchema: { type: 'object', required: ['incentiveCalculations', 'projections', 'artifacts'], properties: { incentiveCalculations: { type: 'object' }, projections: { type: 'object' }, scenarios: { type: 'array', items: { type: 'object' } }, benchmarks: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'quality-reporting', 'incentives', 'healthcare'] }));

export const qrpGovernanceTask = defineTask('qrp-governance', (args, taskCtx) => ({ kind: 'agent', title: 'Quality Governance Structure', agent: { name: 'governance-specialist', prompt: { role: 'Quality Governance Specialist', task: 'Design quality governance', context: args, instructions: ['1. Define governance structure', '2. Create committee charter', '3. Define roles and responsibilities', '4. Design reporting cadence', '5. Create escalation process', '6. Plan physician leadership', '7. Design accountability', '8. Create communication plan', '9. Plan resource allocation', '10. Document governance'], outputFormat: 'JSON with governance structure' }, outputSchema: { type: 'object', required: ['governance', 'committees', 'artifacts'], properties: { governance: { type: 'object' }, committees: { type: 'array', items: { type: 'object' } }, roles: { type: 'array', items: { type: 'object' } }, reporting: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'quality-reporting', 'governance', 'healthcare'] }));

export const qrpImplementationTask = defineTask('qrp-implementation', (args, taskCtx) => ({ kind: 'agent', title: 'QRP Implementation Plan', agent: { name: 'implementation-manager', prompt: { role: 'QRP Implementation Manager', task: 'Plan program implementation', context: args, instructions: ['1. Create implementation timeline', '2. Define resource requirements', '3. Plan technology changes', '4. Design training program', '5. Create communication plan', '6. Define success criteria', '7. Plan risk mitigation', '8. Create governance schedule', '9. Define monitoring plan', '10. Document implementation'], outputFormat: 'JSON with implementation plan' }, outputSchema: { type: 'object', required: ['plan', 'timeline', 'artifacts'], properties: { plan: { type: 'object' }, timeline: { type: 'object' }, resources: { type: 'object' }, training: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'quality-reporting', 'implementation', 'healthcare'] }));

export const qrpDocumentationTask = defineTask('qrp-documentation', (args, taskCtx) => ({ kind: 'agent', title: 'QRP Documentation', agent: { name: 'documentation-writer', prompt: { role: 'QRP Documentation Writer', task: 'Document quality reporting program', context: args, instructions: ['1. Write executive summary', '2. Document program assessment', '3. Include measure selection', '4. Document data infrastructure', '5. Include eCQM compliance', '6. Document improvement plan', '7. Include submission process', '8. Document incentive analysis', '9. Include governance', '10. Format professionally'], outputFormat: 'JSON with documentation' }, outputSchema: { type: 'object', required: ['documentPath', 'artifacts'], properties: { documentPath: { type: 'string' }, summary: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'quality-reporting', 'documentation', 'healthcare'] }));
