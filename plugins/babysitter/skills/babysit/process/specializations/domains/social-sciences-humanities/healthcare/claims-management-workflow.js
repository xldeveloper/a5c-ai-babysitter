/**
 * @process specializations/domains/social-sciences-humanities/healthcare/claims-management-workflow
 * @description Claims Management Workflow - End-to-end process for healthcare claims processing
 * from charge capture through payment posting with denial management and appeals processes.
 * @inputs { organizationName: string, claimsScope?: string, payerMix?: object, currentMetrics?: object }
 * @outputs { success: boolean, workflowDesign: object, automationPlan: object, metrics: object, artifacts: array }
 */

import { defineTask } from '@a5c-ai/babysitter-sdk';

export async function process(inputs, ctx) {
  const { organizationName, claimsScope = 'enterprise', payerMix = {}, currentMetrics = {}, outputDir = 'claims-management-output' } = inputs;
  const startTime = ctx.now();
  const artifacts = [];

  ctx.log('info', `Starting Claims Management Workflow Design for: ${organizationName}`);

  const currentStateAssessment = await ctx.task(claimsCurrentStateTask, { organizationName, claimsScope, currentMetrics, outputDir });
  artifacts.push(...currentStateAssessment.artifacts);

  await ctx.breakpoint({ question: `Current state assessed. Clean claim rate: ${currentStateAssessment.cleanClaimRate}%. ${currentStateAssessment.bottlenecks.length} bottlenecks identified. Proceed?`, title: 'Claims Assessment Review', context: { runId: ctx.runId, cleanClaimRate: currentStateAssessment.cleanClaimRate, bottlenecks: currentStateAssessment.bottlenecks } });

  const chargeCaptureProcess = await ctx.task(chargeCaptureTask, { currentStateAssessment, outputDir });
  artifacts.push(...chargeCaptureProcess.artifacts);

  const claimsScrubbing = await ctx.task(claimsScrubbingTask, { currentStateAssessment, payerMix, outputDir });
  artifacts.push(...claimsScrubbing.artifacts);

  const submissionWorkflow = await ctx.task(claimsSubmissionTask, { claimsScrubbing, payerMix, outputDir });
  artifacts.push(...submissionWorkflow.artifacts);

  await ctx.breakpoint({ question: `Charge capture and submission workflows designed. ${submissionWorkflow.automationOpportunities.length} automation opportunities. Proceed with payment posting?`, title: 'Submission Workflow Review', context: { runId: ctx.runId, automation: submissionWorkflow.automationOpportunities } });

  const paymentPosting = await ctx.task(paymentPostingTask, { submissionWorkflow, outputDir });
  artifacts.push(...paymentPosting.artifacts);

  const denialWorkflow = await ctx.task(denialWorkflowTask, { currentStateAssessment, outputDir });
  artifacts.push(...denialWorkflow.artifacts);

  const appealsProcess = await ctx.task(appealsProcessTask, { denialWorkflow, outputDir });
  artifacts.push(...appealsProcess.artifacts);

  const metricsMonitoring = await ctx.task(claimsMetricsTask, { currentStateAssessment, outputDir });
  artifacts.push(...metricsMonitoring.artifacts);

  const implementationPlan = await ctx.task(claimsImplementationTask, { chargeCaptureProcess, claimsScrubbing, submissionWorkflow, paymentPosting, denialWorkflow, outputDir });
  artifacts.push(...implementationPlan.artifacts);

  const documentation = await ctx.task(claimsDocumentationTask, { organizationName, currentStateAssessment, chargeCaptureProcess, claimsScrubbing, submissionWorkflow, paymentPosting, denialWorkflow, appealsProcess, metricsMonitoring, implementationPlan, outputDir });
  artifacts.push(...documentation.artifacts);

  return { success: true, organizationName, workflowDesign: { chargeCapture: chargeCaptureProcess.workflow, scrubbing: claimsScrubbing.rules, submission: submissionWorkflow.workflow, posting: paymentPosting.workflow, denials: denialWorkflow.workflow }, automationPlan: submissionWorkflow.automationPlan, metrics: metricsMonitoring.metrics, artifacts, duration: ctx.now() - startTime, metadata: { processId: 'specializations/domains/social-sciences-humanities/healthcare/claims-management-workflow', timestamp: startTime, outputDir } };
}

export const claimsCurrentStateTask = defineTask('claims-current-state', (args, taskCtx) => ({ kind: 'agent', title: 'Claims Current State Assessment', agent: { name: 'revenue-cycle-analyst', prompt: { role: 'Revenue Cycle Analyst', task: 'Assess current claims management state', context: args, instructions: ['1. Analyze clean claim rate', '2. Review denial rates by category', '3. Assess days in A/R', '4. Analyze charge lag', '5. Review payment posting timeliness', '6. Identify workflow bottlenecks', '7. Assess technology utilization', '8. Review staffing and productivity', '9. Benchmark against industry', '10. Document findings'], outputFormat: 'JSON with current state assessment' }, outputSchema: { type: 'object', required: ['cleanClaimRate', 'bottlenecks', 'artifacts'], properties: { cleanClaimRate: { type: 'number' }, denialRate: { type: 'number' }, daysInAR: { type: 'number' }, bottlenecks: { type: 'array', items: { type: 'object' } }, benchmarks: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'claims', 'assessment', 'healthcare'] }));

export const chargeCaptureTask = defineTask('charge-capture', (args, taskCtx) => ({ kind: 'agent', title: 'Charge Capture Process', agent: { name: 'charge-capture-specialist', prompt: { role: 'Charge Capture Specialist', task: 'Design charge capture workflow', context: args, instructions: ['1. Map charge capture sources', '2. Define charge entry workflows', '3. Design charge reconciliation', '4. Create charge lag monitoring', '5. Define coding integration', '6. Design late charge process', '7. Create charge audit process', '8. Define charge correction workflow', '9. Plan automation opportunities', '10. Document charge capture process'], outputFormat: 'JSON with charge capture workflow' }, outputSchema: { type: 'object', required: ['workflow', 'sources', 'artifacts'], properties: { workflow: { type: 'object' }, sources: { type: 'array', items: { type: 'object' } }, reconciliation: { type: 'object' }, automation: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'claims', 'charge-capture', 'healthcare'] }));

export const claimsScrubbingTask = defineTask('claims-scrubbing', (args, taskCtx) => ({ kind: 'agent', title: 'Claims Scrubbing Process', agent: { name: 'claims-scrubbing-specialist', prompt: { role: 'Claims Scrubbing Specialist', task: 'Design claims scrubbing workflow', context: args, instructions: ['1. Define scrubbing rules by payer', '2. Design edit management', '3. Create medical necessity checks', '4. Define coding compliance checks', '5. Design demographic validation', '6. Create authorization verification', '7. Define modifier validation', '8. Design bundling/unbundling checks', '9. Create worklist management', '10. Document scrubbing process'], outputFormat: 'JSON with scrubbing workflow' }, outputSchema: { type: 'object', required: ['rules', 'editCategories', 'artifacts'], properties: { rules: { type: 'array', items: { type: 'object' } }, editCategories: { type: 'array', items: { type: 'object' } }, validations: { type: 'object' }, workflow: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'claims', 'scrubbing', 'healthcare'] }));

export const claimsSubmissionTask = defineTask('claims-submission', (args, taskCtx) => ({ kind: 'agent', title: 'Claims Submission Workflow', agent: { name: 'claims-submission-specialist', prompt: { role: 'Claims Submission Specialist', task: 'Design claims submission workflow', context: args, instructions: ['1. Define submission channels', '2. Design electronic submission', '3. Create secondary claims workflow', '4. Define timely filing tracking', '5. Design claim status monitoring', '6. Create resubmission workflow', '7. Define clearinghouse integration', '8. Design paper claims process', '9. Identify automation opportunities', '10. Document submission workflow'], outputFormat: 'JSON with submission workflow' }, outputSchema: { type: 'object', required: ['workflow', 'automationOpportunities', 'artifacts'], properties: { workflow: { type: 'object' }, channels: { type: 'array', items: { type: 'object' } }, automationOpportunities: { type: 'array', items: { type: 'object' } }, automationPlan: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'claims', 'submission', 'healthcare'] }));

export const paymentPostingTask = defineTask('payment-posting', (args, taskCtx) => ({ kind: 'agent', title: 'Payment Posting Workflow', agent: { name: 'payment-posting-specialist', prompt: { role: 'Payment Posting Specialist', task: 'Design payment posting workflow', context: args, instructions: ['1. Design ERA/EOB processing', '2. Create auto-posting rules', '3. Define manual posting workflow', '4. Design contractual adjustment posting', '5. Create patient responsibility workflow', '6. Define refund processing', '7. Design payment reconciliation', '8. Create batch posting process', '9. Define exception handling', '10. Document posting workflow'], outputFormat: 'JSON with posting workflow' }, outputSchema: { type: 'object', required: ['workflow', 'autoPostingRules', 'artifacts'], properties: { workflow: { type: 'object' }, autoPostingRules: { type: 'array', items: { type: 'object' } }, reconciliation: { type: 'object' }, exceptions: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'claims', 'payment-posting', 'healthcare'] }));

export const denialWorkflowTask = defineTask('denial-workflow', (args, taskCtx) => ({ kind: 'agent', title: 'Denial Management Workflow', agent: { name: 'denial-management-specialist', prompt: { role: 'Denial Management Specialist', task: 'Design denial management workflow', context: args, instructions: ['1. Define denial categorization', '2. Design denial routing rules', '3. Create root cause analysis', '4. Define rework workflows', '5. Design prevention strategies', '6. Create denial trending', '7. Define escalation process', '8. Design payer communication', '9. Create denial metrics', '10. Document denial workflow'], outputFormat: 'JSON with denial workflow' }, outputSchema: { type: 'object', required: ['workflow', 'categories', 'artifacts'], properties: { workflow: { type: 'object' }, categories: { type: 'array', items: { type: 'object' } }, routingRules: { type: 'array', items: { type: 'object' } }, preventionStrategies: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'claims', 'denial', 'healthcare'] }));

export const appealsProcessTask = defineTask('appeals-process', (args, taskCtx) => ({ kind: 'agent', title: 'Appeals Process Design', agent: { name: 'appeals-specialist', prompt: { role: 'Appeals Specialist', task: 'Design appeals process', context: args, instructions: ['1. Define appeal levels', '2. Create appeal templates', '3. Design documentation requirements', '4. Define timeline management', '5. Create tracking system', '6. Design success metrics', '7. Define external review process', '8. Create payer-specific workflows', '9. Design escalation paths', '10. Document appeals process'], outputFormat: 'JSON with appeals process' }, outputSchema: { type: 'object', required: ['appealsProcess', 'templates', 'artifacts'], properties: { appealsProcess: { type: 'object' }, templates: { type: 'array', items: { type: 'object' } }, levels: { type: 'array', items: { type: 'object' } }, timelines: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'claims', 'appeals', 'healthcare'] }));

export const claimsMetricsTask = defineTask('claims-metrics', (args, taskCtx) => ({ kind: 'agent', title: 'Claims Management Metrics', agent: { name: 'metrics-analyst', prompt: { role: 'Claims Metrics Analyst', task: 'Design claims metrics program', context: args, instructions: ['1. Define KPI framework', '2. Create clean claim rate metric', '3. Design denial rate tracking', '4. Define days in A/R metrics', '5. Create collection rate metrics', '6. Design productivity metrics', '7. Define cost to collect', '8. Create dashboard design', '9. Plan benchmarking', '10. Document metrics program'], outputFormat: 'JSON with metrics program' }, outputSchema: { type: 'object', required: ['metrics', 'targets', 'artifacts'], properties: { metrics: { type: 'array', items: { type: 'object' } }, targets: { type: 'object' }, dashboard: { type: 'object' }, benchmarks: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'claims', 'metrics', 'healthcare'] }));

export const claimsImplementationTask = defineTask('claims-implementation', (args, taskCtx) => ({ kind: 'agent', title: 'Claims Workflow Implementation', agent: { name: 'implementation-manager', prompt: { role: 'Claims Implementation Manager', task: 'Plan workflow implementation', context: args, instructions: ['1. Create implementation timeline', '2. Define resource requirements', '3. Plan training program', '4. Design communication plan', '5. Plan technology changes', '6. Define success criteria', '7. Create risk mitigation', '8. Plan change management', '9. Define go-live support', '10. Document implementation'], outputFormat: 'JSON with implementation plan' }, outputSchema: { type: 'object', required: ['plan', 'timeline', 'artifacts'], properties: { plan: { type: 'object' }, timeline: { type: 'object' }, resources: { type: 'object' }, training: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'claims', 'implementation', 'healthcare'] }));

export const claimsDocumentationTask = defineTask('claims-documentation', (args, taskCtx) => ({ kind: 'agent', title: 'Claims Workflow Documentation', agent: { name: 'documentation-writer', prompt: { role: 'Claims Documentation Writer', task: 'Document claims workflow', context: args, instructions: ['1. Write executive summary', '2. Document current state', '3. Include workflow designs', '4. Document automation plan', '5. Include metrics program', '6. Document implementation', '7. Add appendices', '8. Include job aids', '9. Create quick reference', '10. Format professionally'], outputFormat: 'JSON with documentation' }, outputSchema: { type: 'object', required: ['documentPath', 'artifacts'], properties: { documentPath: { type: 'string' }, summary: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'claims', 'documentation', 'healthcare'] }));
