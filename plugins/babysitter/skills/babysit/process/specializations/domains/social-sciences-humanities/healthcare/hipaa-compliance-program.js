/**
 * @process specializations/domains/social-sciences-humanities/healthcare/hipaa-compliance-program
 * @description HIPAA Compliance Program - Comprehensive framework for establishing and maintaining
 * HIPAA Privacy, Security, and Breach Notification Rule compliance across the organization.
 * @inputs { organizationName: string, complianceScope?: string, entityType?: string, currentState?: object }
 * @outputs { success: boolean, complianceProgram: object, riskAssessment: object, policies: array, artifacts: array }
 */

import { defineTask } from '@a5c-ai/babysitter-sdk';

export async function process(inputs, ctx) {
  const { organizationName, complianceScope = 'enterprise', entityType = 'covered-entity', currentState = {}, outputDir = 'hipaa-compliance-output' } = inputs;
  const startTime = ctx.now();
  const artifacts = [];

  ctx.log('info', `Starting HIPAA Compliance Program for: ${organizationName}`);

  const gapAssessment = await ctx.task(hipaaGapAssessmentTask, { organizationName, complianceScope, entityType, currentState, outputDir });
  artifacts.push(...gapAssessment.artifacts);

  await ctx.breakpoint({ question: `Gap assessment complete. Compliance score: ${gapAssessment.complianceScore}%. ${gapAssessment.criticalGaps.length} critical gaps identified. Proceed?`, title: 'HIPAA Gap Assessment Review', context: { runId: ctx.runId, score: gapAssessment.complianceScore, criticalGaps: gapAssessment.criticalGaps } });

  const riskAssessment = await ctx.task(hipaaRiskAssessmentTask, { gapAssessment, outputDir });
  artifacts.push(...riskAssessment.artifacts);

  const privacyProgram = await ctx.task(hipaaPrivacyTask, { gapAssessment, entityType, outputDir });
  artifacts.push(...privacyProgram.artifacts);

  const securityProgram = await ctx.task(hipaaSecurityTask, { gapAssessment, riskAssessment, outputDir });
  artifacts.push(...securityProgram.artifacts);

  await ctx.breakpoint({ question: `Privacy and Security programs designed. ${privacyProgram.policies.length} privacy policies, ${securityProgram.safeguards.length} security safeguards. Proceed?`, title: 'Privacy/Security Program Review', context: { runId: ctx.runId, privacy: privacyProgram.policies, security: securityProgram.safeguards } });

  const breachProgram = await ctx.task(hipaaBreachTask, { securityProgram, outputDir });
  artifacts.push(...breachProgram.artifacts);

  const trainingProgram = await ctx.task(hipaaTrainingTask, { privacyProgram, securityProgram, outputDir });
  artifacts.push(...trainingProgram.artifacts);

  const auditProgram = await ctx.task(hipaaAuditTask, { privacyProgram, securityProgram, outputDir });
  artifacts.push(...auditProgram.artifacts);

  const baManagement = await ctx.task(hipaaBATask, { privacyProgram, outputDir });
  artifacts.push(...baManagement.artifacts);

  const implementationPlan = await ctx.task(hipaaImplementationTask, { gapAssessment, privacyProgram, securityProgram, breachProgram, outputDir });
  artifacts.push(...implementationPlan.artifacts);

  const documentation = await ctx.task(hipaaDocumentationTask, { organizationName, gapAssessment, riskAssessment, privacyProgram, securityProgram, breachProgram, trainingProgram, auditProgram, baManagement, implementationPlan, outputDir });
  artifacts.push(...documentation.artifacts);

  return { success: true, organizationName, complianceProgram: { privacy: privacyProgram.program, security: securityProgram.program, breach: breachProgram.program }, riskAssessment: riskAssessment.assessment, policies: [...privacyProgram.policies, ...securityProgram.policies], artifacts, duration: ctx.now() - startTime, metadata: { processId: 'specializations/domains/social-sciences-humanities/healthcare/hipaa-compliance-program', timestamp: startTime, outputDir } };
}

export const hipaaGapAssessmentTask = defineTask('hipaa-gap-assessment', (args, taskCtx) => ({ kind: 'agent', title: 'HIPAA Gap Assessment', agent: { name: 'hipaa-analyst', prompt: { role: 'HIPAA Compliance Analyst', task: 'Conduct HIPAA gap assessment', context: args, instructions: ['1. Assess Privacy Rule compliance', '2. Assess Security Rule compliance', '3. Review Breach Notification readiness', '4. Evaluate administrative safeguards', '5. Assess physical safeguards', '6. Review technical safeguards', '7. Evaluate policies and procedures', '8. Assess training compliance', '9. Review BA agreements', '10. Document gaps and compliance score'], outputFormat: 'JSON with gap assessment' }, outputSchema: { type: 'object', required: ['complianceScore', 'criticalGaps', 'artifacts'], properties: { complianceScore: { type: 'number' }, criticalGaps: { type: 'array', items: { type: 'object' } }, privacyGaps: { type: 'array', items: { type: 'object' } }, securityGaps: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'hipaa', 'gap-assessment', 'healthcare'] }));

export const hipaaRiskAssessmentTask = defineTask('hipaa-risk-assessment', (args, taskCtx) => ({ kind: 'agent', title: 'HIPAA Risk Assessment', agent: { name: 'risk-analyst', prompt: { role: 'HIPAA Risk Analyst', task: 'Conduct security risk assessment', context: args, instructions: ['1. Identify ePHI assets', '2. Identify threats and vulnerabilities', '3. Assess current controls', '4. Determine likelihood of threats', '5. Assess potential impact', '6. Calculate risk levels', '7. Prioritize risks', '8. Develop mitigation strategies', '9. Document risk decisions', '10. Create risk management plan'], outputFormat: 'JSON with risk assessment' }, outputSchema: { type: 'object', required: ['assessment', 'risks', 'artifacts'], properties: { assessment: { type: 'object' }, risks: { type: 'array', items: { type: 'object' } }, assets: { type: 'array', items: { type: 'object' } }, mitigationPlan: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'hipaa', 'risk-assessment', 'healthcare'] }));

export const hipaaPrivacyTask = defineTask('hipaa-privacy', (args, taskCtx) => ({ kind: 'agent', title: 'HIPAA Privacy Program', agent: { name: 'privacy-officer', prompt: { role: 'HIPAA Privacy Officer', task: 'Design privacy compliance program', context: args, instructions: ['1. Design Notice of Privacy Practices', '2. Create patient rights procedures', '3. Define minimum necessary policies', '4. Design authorization forms', '5. Create disclosure tracking', '6. Define privacy incident process', '7. Design complaint process', '8. Create workforce sanctions', '9. Define privacy officer role', '10. Document privacy program'], outputFormat: 'JSON with privacy program' }, outputSchema: { type: 'object', required: ['program', 'policies', 'artifacts'], properties: { program: { type: 'object' }, policies: { type: 'array', items: { type: 'object' } }, procedures: { type: 'array', items: { type: 'object' } }, forms: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'hipaa', 'privacy', 'healthcare'] }));

export const hipaaSecurityTask = defineTask('hipaa-security', (args, taskCtx) => ({ kind: 'agent', title: 'HIPAA Security Program', agent: { name: 'security-officer', prompt: { role: 'HIPAA Security Officer', task: 'Design security compliance program', context: args, instructions: ['1. Design administrative safeguards', '2. Create physical safeguards', '3. Define technical safeguards', '4. Design access controls', '5. Create audit controls', '6. Define encryption requirements', '7. Design integrity controls', '8. Create transmission security', '9. Define contingency planning', '10. Document security program'], outputFormat: 'JSON with security program' }, outputSchema: { type: 'object', required: ['program', 'safeguards', 'policies', 'artifacts'], properties: { program: { type: 'object' }, safeguards: { type: 'array', items: { type: 'object' } }, policies: { type: 'array', items: { type: 'object' } }, technicalControls: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'hipaa', 'security', 'healthcare'] }));

export const hipaaBreachTask = defineTask('hipaa-breach', (args, taskCtx) => ({ kind: 'agent', title: 'HIPAA Breach Notification Program', agent: { name: 'breach-specialist', prompt: { role: 'Breach Notification Specialist', task: 'Design breach notification program', context: args, instructions: ['1. Define breach identification', '2. Create risk assessment process', '3. Design notification procedures', '4. Define timeline requirements', '5. Create notification templates', '6. Design documentation requirements', '7. Define media notification', '8. Create HHS reporting process', '9. Design post-breach review', '10. Document breach program'], outputFormat: 'JSON with breach program' }, outputSchema: { type: 'object', required: ['program', 'procedures', 'artifacts'], properties: { program: { type: 'object' }, procedures: { type: 'array', items: { type: 'object' } }, templates: { type: 'array', items: { type: 'object' } }, timelines: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'hipaa', 'breach', 'healthcare'] }));

export const hipaaTrainingTask = defineTask('hipaa-training', (args, taskCtx) => ({ kind: 'agent', title: 'HIPAA Training Program', agent: { name: 'training-specialist', prompt: { role: 'HIPAA Training Specialist', task: 'Design training compliance program', context: args, instructions: ['1. Define training requirements', '2. Create role-based curriculum', '3. Design new hire training', '4. Create annual refresher', '5. Define specialized training', '6. Design training tracking', '7. Create competency assessments', '8. Define documentation requirements', '9. Design awareness program', '10. Document training program'], outputFormat: 'JSON with training program' }, outputSchema: { type: 'object', required: ['trainingProgram', 'curriculum', 'artifacts'], properties: { trainingProgram: { type: 'object' }, curriculum: { type: 'array', items: { type: 'object' } }, assessments: { type: 'array', items: { type: 'object' } }, tracking: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'hipaa', 'training', 'healthcare'] }));

export const hipaaAuditTask = defineTask('hipaa-audit', (args, taskCtx) => ({ kind: 'agent', title: 'HIPAA Audit Program', agent: { name: 'audit-specialist', prompt: { role: 'HIPAA Audit Specialist', task: 'Design compliance audit program', context: args, instructions: ['1. Define audit schedule', '2. Create audit protocols', '3. Design internal audits', '4. Define external audit prep', '5. Create audit checklists', '6. Design corrective action', '7. Define audit documentation', '8. Create audit reporting', '9. Design continuous monitoring', '10. Document audit program'], outputFormat: 'JSON with audit program' }, outputSchema: { type: 'object', required: ['auditProgram', 'schedule', 'artifacts'], properties: { auditProgram: { type: 'object' }, schedule: { type: 'object' }, protocols: { type: 'array', items: { type: 'object' } }, checklists: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'hipaa', 'audit', 'healthcare'] }));

export const hipaaBATask = defineTask('hipaa-ba-management', (args, taskCtx) => ({ kind: 'agent', title: 'Business Associate Management', agent: { name: 'ba-specialist', prompt: { role: 'Business Associate Management Specialist', task: 'Design BA management program', context: args, instructions: ['1. Define BA identification', '2. Create BA agreement template', '3. Design due diligence process', '4. Define monitoring requirements', '5. Create BA inventory', '6. Design renewal process', '7. Define incident reporting', '8. Create termination procedures', '9. Design subcontractor requirements', '10. Document BA program'], outputFormat: 'JSON with BA program' }, outputSchema: { type: 'object', required: ['baProgram', 'agreementTemplate', 'artifacts'], properties: { baProgram: { type: 'object' }, agreementTemplate: { type: 'object' }, dueDiligence: { type: 'object' }, inventory: { type: 'array', items: { type: 'object' } }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'hipaa', 'business-associate', 'healthcare'] }));

export const hipaaImplementationTask = defineTask('hipaa-implementation', (args, taskCtx) => ({ kind: 'agent', title: 'HIPAA Implementation Plan', agent: { name: 'implementation-manager', prompt: { role: 'HIPAA Implementation Manager', task: 'Plan compliance implementation', context: args, instructions: ['1. Prioritize remediation efforts', '2. Create implementation timeline', '3. Define resource requirements', '4. Plan quick wins', '5. Design change management', '6. Create communication plan', '7. Define success criteria', '8. Plan risk mitigation', '9. Create governance structure', '10. Document implementation'], outputFormat: 'JSON with implementation plan' }, outputSchema: { type: 'object', required: ['plan', 'timeline', 'artifacts'], properties: { plan: { type: 'object' }, timeline: { type: 'object' }, resources: { type: 'object' }, governance: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'hipaa', 'implementation', 'healthcare'] }));

export const hipaaDocumentationTask = defineTask('hipaa-documentation', (args, taskCtx) => ({ kind: 'agent', title: 'HIPAA Program Documentation', agent: { name: 'documentation-writer', prompt: { role: 'HIPAA Documentation Writer', task: 'Document HIPAA program', context: args, instructions: ['1. Write executive summary', '2. Document gap assessment', '3. Include risk assessment', '4. Document privacy program', '5. Include security program', '6. Document breach program', '7. Include training program', '8. Document audit program', '9. Include BA management', '10. Format professionally'], outputFormat: 'JSON with documentation' }, outputSchema: { type: 'object', required: ['documentPath', 'artifacts'], properties: { documentPath: { type: 'string' }, summary: { type: 'object' }, artifacts: { type: 'array' } } } }, io: { inputJsonPath: `tasks/${taskCtx.effectId}/input.json`, outputJsonPath: `tasks/${taskCtx.effectId}/result.json` }, labels: ['agent', 'hipaa', 'documentation', 'healthcare'] }));
